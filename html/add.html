<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Music Adder</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f5f5f5; }
    .song { border: 1px solid #ccc; margin: 10px 0; padding: 10px; background: white; border-radius: 6px; display: flex; align-items: center; justify-content: space-between; }
    img { height: 50px; margin-right: 10px; }
    .info { flex: 1; display: flex; align-items: center; }
    button { padding: 4px 10px; margin-left: 10px; }
    pre { background: #222; color: #eee; padding: 10px; border-radius: 6px; overflow-x: auto; white-space: pre-wrap; }
  </style>
</head>
<body>

<h2>üéµ Danh s√°ch nh·∫°c</h2>

<input type="file" id="fileInput" multiple accept=".mp3,.mp4,.jpg,.jpeg,.png"/><br><br>
<div id="songList"></div>

<h3>M·∫£ng songs (d·∫°ng JS Object):</h3>
<pre id="songsOutput">[]</pre>

<script>
let songs = [];
document.getElementById('fileInput').addEventListener('change', function (e) {
    const files = Array.from(e.target.files);

    // T√°ch file nh·∫°c, video v√† ·∫£nh
    const audioFiles = files.filter(file => file.type.startsWith('audio') || file.type === 'video/mp4');
    const imageFiles = files.filter(file => file.type.startsWith('image'));

    // ƒê·∫©y c√°c b√†i nh·∫°c + ·∫£nh ƒë√≠nh k√®m (n·∫øu c√≥)
    audioFiles.forEach(file => {
        const name = file.name.replace(/\.[^/.]+$/, "").trim();
        const artist = guessArtistFromName(name);
        const musicPath = `../nhac/${file.name}`;

        // T√¨m ·∫£nh c√≥ t√™n tr√πng ho·∫∑c g·∫ßn tr√πng t√™n file nh·∫°c (b·ªè ƒëu√¥i)
        const imageFile = imageFiles.find(img => {
            const imgName = img.name.replace(/\.[^/.]+$/, "").trim().toLowerCase();
            return name.toLowerCase().includes(imgName) || imgName === name.toLowerCase();
        });
        const imagePath = imageFile ? `../nhac/${imageFile.name}` : '';

        // N·∫øu ·∫£nh n√†y ƒë√£ t·ªìn t·∫°i trong m·∫£ng songs nh∆∞ 1 object ch·ªâ c√≥ ·∫£nh th√¨ x√≥a n√≥ ƒëi ƒë·ªÉ tr√°nh tr√πng
        if (imageFile) {
            const imgNameNoExt = imageFile.name.replace(/\.[^/.]+$/, "").trim();
            songs = songs.filter(s => s.name.toLowerCase() !== imgNameNoExt.toLowerCase() || s.path !== '');
        }

        const song = { name, path: musicPath, artist, image: imagePath };
        songs.push(song);
    });

    // ƒê·∫©y th√™m c√°c ·∫£nh m√† ch∆∞a c√≥ trong m·∫£ng songs (theo t√™n file ·∫£nh)
    imageFiles.forEach(imgFile => {
        const imgName = imgFile.name.replace(/\.[^/.]+$/, "").trim().toLowerCase();

        // Ki·ªÉm tra ƒë√£ c√≥ b√†i h√°t ho·∫∑c ·∫£nh v·ªõi t√™n n√†y ch∆∞a
        const exists = songs.some(s => s.name.toLowerCase() === imgName);
        if (!exists) {
            // Th√™m 1 object ch·ªâ c√≥ ·∫£nh, c√°c tr∆∞·ªùng kh√°c ƒë·ªÉ tr·ªëng ho·∫∑c m·∫∑c ƒë·ªãnh
            songs.push({
                name: imgName,
                path: '',      // Kh√¥ng c√≥ nh·∫°c
                artist: 'Kh√¥ng r√µ',
                image: `../nhac/${imgFile.name}`
            });
        }
    });

    renderSongs();
    renderSongsOutput();
});

// H√†m ƒëo√°n artist theo t√™n file (n·∫øu c√≥ d·∫•u " - ")
function guessArtistFromName(name) {
    if (name.includes(' - ')) {
        const parts = name.split(' - ');
        return parts[1] || 'Kh√¥ng r√µ';
    }
    return 'Kh√¥ng r√µ';
}

function renderSongs() {
    const list = document.getElementById('songList');
    list.innerHTML = '';

    songs.forEach((song, index) => {
        const div = document.createElement('div');
        div.className = 'song';
        div.innerHTML = `
            <div class="info">
                ${song.image ? `<img src="${song.image}" alt="cover">` : ''}
                <div>
                    <strong>${song.name}</strong><br>
                    <small>${song.artist}</small>
                </div>
            </div>
            <audio controls src="${song.path}" style="margin: 0 10px;"></audio>
            <button onclick="deleteSong(${index})">‚ùå X√≥a</button>
        `;
        list.appendChild(div);
    });
}

function renderSongsOutput() {
    const output = document.getElementById('songsOutput');
    const text = songs.map(song => `{
    name: '${song.name}',
    path: '${song.path}',
    artist: '${song.artist}',
    image: '${song.image}'
}`).join(',\n');

    output.textContent = '[\n' + text + '\n]';
}

function deleteSong(index) {
    songs.splice(index, 1);
    renderSongs();
    renderSongsOutput();
}
</script>

</body>
</html>
